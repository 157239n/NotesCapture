<!DOCTYPE html>
<html lang="en_US">
<head>
    <title>Try embedding</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="styles.css">
    <style>
        #toolBar {
            width: 30vw;
            position: fixed;
            left: 70vw;
            top: 0;
            z-index: 10001;
        }

        textarea {
            resize: none;
        }

        .updateComment {
            margin-top: 8px;
        }
    </style>
</head>
<body>
<iframe sandbox="allow-scripts allow-same-origin" id="page" src="empty"></iframe>
<div id="panel">
    <div id="toolBar" class="w3-bar w3-light-grey w3-card">
        <a class="w3-bar-item w3-button" onclick="highlights.capture()">New</a>
        <div class="w3-bar-item w3-button w3-right w3-dropdown-hover" style="height: 38px;"><i class="material-icons">settings</i>
            <div class="w3-dropdown-content w3-bar-block w3-card-4" style="position: fixed;right: 0; top: 38px;">
                <a href="https://virus.kelvinho.org/profile" class="w3-bar-item w3-button">Profile</a>
                <a href="https://virus.kelvinho.org/logout" class="w3-bar-item w3-button">Sign out</a>
            </div>
        </div>
        <a class="w3-bar-item w3-button w3-right w3-border-right">Hold</a>
    </div>
    <input type="button" value="New highlight" onclick="highlights.capture()">
</div>
<div class="boundingBox" id="bb1"></div>
</body>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="scripts.js"></script>
<script type="text/javascript">
    const gui = {"body": $("body")[0], "panel": $("#panel")};

    class Highlight {
        /**
         * Constructs a highlight section.
         *
         * @param {Element[]} elements
         */
        constructor(elements) {
            /** @type {Element[]} this.elements */ this.elements = elements;
            let id = Math.floor(Math.random() * 1000000);

            gui.panel.append(`<div class="boundingBox" id="bb${id}"></div>`);
            this.boundingBoxReference = $(`#bb${id}`);

            gui.panel.append(`<div class="contentBox w3-border w3-round-large w3-card" id="cb${id}">
<label>Comment</label>
<textarea id="profile" cols="80" class="w3-input w3-border w3-round"></textarea>
<button class="updateComment w3-btn w3-indigo w3-round" onclick="updateVirus()">Update</button>
<button class="updateComment w3-btn w3-light-green w3-round" onclick="updateVirus()">Delete</button>
</div>`);
            this.contentBoxReference = $(`#cb${id}`);

            this.updatePosition();
        }

        /**
         * Updates the position of this highlight, used when the user is scrolling.
         */
        updatePosition() {
            const y = boundingBoxOfElements(this.elements, this.boundingBoxReference);
            this.contentBoxReference.css("top", y-this.contentBoxReference.height()/2);
        }
    }

    class Highlights {
        constructor() {
            self.highlights = [];
        }

        /**
         * Tries to capture the current selection.
         *
         * @return {number} Selection index if can, -1 otherwise
         */
        capture() {
            const elements = elementsFromStrings(selectionStrings());
            if (elements.length === 0) return -1;
            self.highlights.push(new Highlight(elements));
            return self.highlights.length - 1;
        }

        updatePositions() {
            for (let i = 0; i < self.highlights.length; i++) self.highlights[i].updatePosition();
        }
    }

    const highlights = new Highlights();

    const url = "https://stackoverflow.com/questions/3076414/ways-to-circumvent-the-same-origin-policy";
    //const url = "https://ruder.io/optimizing-gradient-descent/index.html"; // this one can only work when I have already done the redirect thingy
    //const url = "https://github.com/157239n/Virus";
    //const url = "https://github.com/hieudan225/step";
    //const url = "https://github.com/hieudan225";
    //const url = "https://www.google.com/search?sxsrf=ALeKk00x9mSGurMtvEiuVSvCZlxccOZw7g%3A1591592825260&ei=ecfdXuPAD5PM1QHMpqbYDQ&q=set+iframe+origin+of+base64&oq=set+iframe+origin+of+base64&gs_lcp=CgZwc3ktYWIQA1AAWABgk4kBaABwAHgAgAEAiAEAkgEAmAEAqgEHZ3dzLXdpeg&sclient=psy-ab&ved=0ahUKEwij4eenufHpAhUTZjUKHUyTCdsQ4dUDCAw&uact=5";
    //const url = "https://157239n.com";
    //const url = "https://nn.157239n.com";
    fetch("getRss.php?rss=" + btoa(url)).then(response => response.text())
        .then(data => {
            document.getElementById('page').contentWindow.document.write(data);
        }).then(() => {
        document.getElementById("page").contentWindow.onscroll = () => {
            highlights.updatePositions();
            //if (elements !== null) reposition();
        }
    });

    document.getElementById("panel").onwheel = () => {
    }
</script>
</html>
